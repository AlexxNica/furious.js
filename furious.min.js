!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.furious=e()}}(function(){return function e(f,o,n){function d(t,u){if(!o[t]){if(!f[t]){var l="function"==typeof require&&require;if(!u&&l)return l(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var p=o[t]={exports:{}};f[t][0].call(p.exports,function(e){var o=f[t][1][e];return d(o?o:e)},p,p.exports,e,f,o,n)}return o[t].exports}for(var i="function"==typeof require&&require,t=0;t<n.length;t++)d(n[t]);return d}({1:[function(e,f){"use strict";function o(e){if(!(["f32","f64"].indexOf(e)>=0))throw new RangeError("Type "+e+" is not supported");this.type=e,this.size={f32:4,f64:8}[e],this.epsilon={f32:1.1920928955078125e-7,f64:2.220446049250313e-16}[e],this.arrayType={f32:Float32Array,f64:Float64Array}[e]}o.prototype.equals=function(e){return e instanceof o&&this.arrayType===e.arrayType},f.exports=o},{}],2:[function(e,f){"use strict";function o(e){e(this)}var n=e("./NDArray"),d=e("./DataType"),i=e("./util"),t=e("./jsmath");o.prototype.empty=function(e,f){return this.zeros(e,f)},o.prototype.zeros=function(e,f){e=i.checkShape(e),f="undefined"==typeof f?new d("f64"):i.checkDataType(f);var o=new n(e,f,this);return o._data=new f.arrayType(o.length),o},o.prototype.ones=function(e,f){var o=this.zeros(e,f);return t.fill(o._data,1),o},o.prototype.array=function(e,f){f="undefined"==typeof f?new d("f64"):i.checkDataType(f);var o=[];i.discoverArrayShapeRecursive(e,o,0);var n=this.empty(o,f);return i.copyArrayDataRecursive(n._data,e,o,0,0),n},o.prototype._invalidate=function(e){i.checkNDArray(e,"array"),e._data=null},o.prototype.get=function(){if(0===arguments.length)throw new Error("Callback argument missing");var e=arguments[arguments.length-1];if(1===arguments.length)throw new Error("At least one NDArray argument expected");for(var f=0;f<arguments.length-1;++f)i.checkNDArray(arguments[f],"argument "+f);for(var f=0;f<arguments.length-1;++f)arguments[f]._decRef();for(var o=new Array(arguments.length-1),f=0;f<o.length;++f){var n=arguments[f];if(0===n.shape.length)o[f]=n._data[0];else{var d=new Array(n.shape[0]);i.createArrayRecursive(n._data,d,n.shape,0,0),o[f]=d}}for(var f=0;f<arguments.length-1;++f)arguments[f]._tryInvalidate();e.apply(null,o)},o.prototype.reshape=function(e,f){if(f=i.checkShape(f),i.computeLength(f)!==e.length)throw new RangeError("The shape is not compatible with the array");var o=new n(f,e.dataType,this);return e._decRef()?(o._data=new o.dataType.arrayType(o.length),o._data.set(e._data)):(o._data=e._data,e._tryInvalidate()),o},o.prototype.repeat=function(e,f,o,n){i.checkNDArray(e,"a"),f=i.checkRepeats(f),o=i.checkAxis(o,e.shape.length);var d=e.shape,u=d.slice(0);u[o]*=f,e._decRef();try{"undefined"==typeof n?n=this.empty(u,e.dataType):(i.checkNDArray(n,"out"),i.checkShapesCompatibility(n.shape,u),i.checkDataTypesCompatibility(e.dataType,n.dataType),n._incRef());var l=i.computeOuterStride(d,o),p=i.computeInnerStride(d,o);t.repeat(e._data,n._data,l,p,d[o],f)}catch(s){throw e._incRef(),s}return e._tryInvalidate(),n};var u=function(e,f,o,d,t,u,l){var p=null,s=null;if(e instanceof n){if(p=e.shape,s=e.dataType,f instanceof n)i.checkShapesCompatibility(e.shape,f.shape),i.checkDataTypesCompatibility(e.dataType,f.dataType);else if(!i.isNumber(f))throw new TypeError("Unsupported type of b")}else{if(!i.isNumber(e))throw new TypeError("Unsupported type of a");p=f.shape,s=f.dataType,i.checkNDArray(f,"b")}e instanceof n&&e._decRef(),f instanceof n&&f._decRef();try{"undefined"==typeof o?(o=new n(p,s,d),o._data=e instanceof n&&!e._hasRefs()?e._data:f instanceof n&&!f._hasRefs()?f._data:new s.arrayType(o.length)):(i.checkNDArray(o,"out"),i.checkShapesCompatibility(p,o.shape),i.checkDataTypesCompatibility(s,o.dataType),o._incRef()),e instanceof n?f instanceof n?t(e._data,f._data,o._data):u(e._data,+f,o._data):l(f._data,+e,o._data)}catch(y){throw e instanceof n&&e._incRef(),f instanceof n&&f._incRef(),y}return e instanceof n&&e._tryInvalidate(),f instanceof n&&f._tryInvalidate(),o},l=function(e,f,o,d){i.checkNDArray(e,"a"),e._decRef();try{"undefined"==typeof f?(f=new n(e.shape,e.dataType,o),f._data=e instanceof n&&!e._hasRefs()?e._data:new e.dataType.arrayType(f.length)):(i.checkNDArray(f,"out"),i.checkShapesCompatibility(e.shape,f.shape),i.checkDataTypesCompatibility(e.dataType,f.dataType),f._incRef()),d(e._data,f._data)}catch(t){throw e._incRef(),t}return e._tryInvalidate(),f},p=function(e,f,o,n,d,t){if(i.checkNDArray(e,"a"),"undefined"==typeof f)return"undefined"==typeof o?o=n.empty([],e.dataType):(i.checkNDArray(o,"out"),i.checkShapesCompatibility([],o.shape),i.checkDataTypesCompatibility(e.dataType,o.dataType),o._incRef()),d(e._data,o._data),e._tryRelease(),o;f=i.checkAxis(f,e.shape.length);var u=i.computeAxisReductionOutShape(e.shape,f);if("undefined"==typeof o)var o=n.empty(u,e.dataType);else i.checkNDArray(o,"out"),i.checkShapesCompatibility([],o.shape),i.checkDataTypesCompatibility(e.dataType,o.dataType),o._incRef();return t(e._data,o._data,i.computeOuterStride(e.shape,f),i.computeInnerStride(e.shape,f),e.shape[f]),e._tryRelease(),o};o.prototype.add=function(e,f,o){return u(e,f,o,this,t.add,t.addConst,t.addConst)},o.prototype.sub=function(e,f,o){return u(e,f,o,this,t.sub,t.subConst,t.subRevConst)},o.prototype.mul=function(e,f,o){return u(e,f,o,this,t.mul,t.mulConst,t.mulConst)},o.prototype.div=function(e,f,o){return u(e,f,o,this,t.div,t.divConst,t.divRevConst)},o.prototype.min=function(e,f,o){return p(e,f,o,this,t.min,t.axisMin)},o.prototype.max=function(e,f,o){return p(e,f,o,this,t.max,t.axisMax)},o.prototype.sum=function(e,f,o){return p(e,f,o,this,t.sum,t.axisSum)},o.prototype.neg=function(e,f){return l(e,f,this,t.neg)},o.prototype.abs=function(e,f){return l(e,f,this,t.abs)},o.prototype.exp=function(e,f){return l(e,f,this,t.exp)},o.prototype.log=function(e,f){return l(e,f,this,t.log)},o.prototype.sqrt=function(e,f){return l(e,f,this,t.sqrt)},o.prototype.square=function(e,f){return l(e,f,this,t.square)},o.prototype.dot=function(e,f,o){i.checkNDArray(e,"a"),i.checkNDArray(f,"b"),i.checkDataTypesCompatibility(e.dataType,f.dataType);var d=Math.max(e.shape.length-1,0),u=Math.max(f.shape.length-2,0),l=e.shape[d];if(l!==f.shape[u])throw new RangeError("Arrays have incompatible reduction dimensions");for(var p=[],s=1,y=1,c=1,r=0;d>r;r++)p.push(e.shape[r]),s*=e.shape[r];for(var r=0;r<f.shape.length;r++){var a=f.shape[r];u>r?(y*=a,p.push(a)):r>u&&(c*=a,p.push(a))}return"undefined"==typeof o?o=this.empty(p,e.dataType):o instanceof n&&(i.checkNDArray(o,"out"),i.checkShapesCompatibility(o.shape,p),i.checkDataTypesCompatibility(o.dataType,e.dataType),i.checkDifferentNDArrays(e,o,"a","out"),i.checkDifferentNDArrays(f,o,"b","out"),o._incRef()),t.dot(e._data,f._data,o._data,s,y,c,l),e._tryRelease(),f._tryRelease(),o},o.prototype.linspace=function(e,f,o,n){if(!i.isReal(e))throw new TypeError(e+" is not a real number");if(!i.isReal(f))throw new TypeError(f+" is not a real number");if("undefined"==typeof o)o=50;else{if(!i.isInt(o))throw new TypeError(o+" is not an integer");if(0>=o)throw new RangeError("The number of samples must be positive")}if("undefined"==typeof n&&(n=!0),n&&1===o)throw new RangeError("The number of samples must be a least 2 (for start and end points)");for(var t=this.empty(o,new d("f64")),u=t._data,l=f-e,p=n?o-1:o,s=l/p,y=0;o>y;y++)u[y]=e+s*y;return t},f.exports=o},{"./DataType":1,"./NDArray":3,"./jsmath":7,"./util":8}],3:[function(e,f){"use strict";function o(e){for(var f=1,o=0;o<e.length;o++)f*=e[o];return f}function n(e,f,n){if("undefined"==typeof n)throw new Error("Context not defined");if(!d.isPositiveIntArray(e)&&!d.isPositiveInt(e))throw new TypeError(e+" is not a valid array shape");if("undefined"==typeof f)f=new i("f64");else if(!(f instanceof i))throw new TypeError(f+" is not an instance of DataType");this.shape=d.asIntArray(e),this.dataType=f,this._context=n,this.length=o(this.shape),this._lockCount=0,this._refCount=1,this._isValid=!0}var d=e("./util"),i=e("./DataType");n.prototype.lock=function(){if(!this.isValid())throw new Error("Attempted to lock an invalidated array");return this._lockCount++,this},n.prototype.unlock=function(){if(!this.isLocked())throw new Error("Attempted to lock a unlocked array");return this._lockCount--,this},n.prototype.isLocked=function(){return this._lockCount>0},n.prototype.retain=function(){if(!this.isValid())throw new Error("Attempted to release an invalidated array");if(this.isLocked())throw new Error("Attempted to retain a locked array");return this._refCount++,this},n.prototype.release=function(){if(!this.isValid())throw new Error("Attempted to release an invalidated array");if(this.isLocked())throw new Error("Attempted to release a locked array");return 0===--this._refCount&&this._context._invalidate(this),this},n.prototype.tryRelease=function(){if(!this.isValid())throw new Error("Attempted to release an invalidated array");return this.isLocked()||0===--this._refCount&&this._context._invalidate(this),this},n.prototype._tryRelease=function(){return this.isLocked()||0===--this._refCount&&this._context._invalidate(this),this},n.prototype.invalidate=function(){return this.isValid()&&(this._context._invalidate(this),this._isValid=!1,this._refCount=0,this._lockCount=0),this},n.prototype.isValid=function(){return this._isValid},n.prototype._decRef=function(){return 0===this._lockCount&&--this._refCount,0!==this._refCount},n.prototype._incRef=function(){return 0===this._lockCount&&++this._refCount,this},n.prototype._hasRefs=function(){return 0!==this._lockCount||0!==this._refCount},n.prototype._tryInvalidate=function(){return this.isValid()&&!this._hasRefs()?(this._context._invalidate(this),this._isValid=!1,!0):!1},n.prototype.add=function(e){return this._context.add(this,e)},n.prototype.sub=function(e){return this._context.sub(this,e)},n.prototype.mul=function(e){return this._context.mul(this,e)},n.prototype.div=function(e){return this._context.div(this,e)},n.prototype.min=function(e){return this._context.min(this,e)},n.prototype.max=function(e){return this._context.max(this,e)},n.prototype.sum=function(e){return this._context.sum(this,e)},n.prototype.reshape=function(e){return this._context.reshape(this,e)},n.prototype.repeat=function(e,f){return this._context.repeat(this,e,f)},n.prototype.get=function(e){this._context.get(this,e)},f.exports=n},{"./DataType":1,"./util":8}],4:[function(e,f){"use strict";function o(e){var f=this;this._pnaclObject=document.createElement("object"),this._pnaclObject.width=0,this._pnaclObject.height=0,this._pnaclObject.data=u+"furious.nmf",this._pnaclObject.type="application/x-pnacl",this._pnaclObject.addEventListener("load",function(){var o=i.newMessageId();a[o]=function(){e(f)},f._pnaclObject.postMessage({id:o,command:"init"})},!0),this._pnaclObject.addEventListener("message",w,!0),document.body.appendChild(this._pnaclObject)}var n=e("./NDArray"),d=e("./DataType"),i=e("./allocator"),t=e("./util"),u="";try{for(var l=document.getElementsByTagName("script"),p=l.length-1;p>=0;--p){var s=l[p].src;s=s.split("?")[0];var y=s.lastIndexOf("/"),c=s.substring(y+1);if("furious.js"===c||"furious.min.js"===c){u=s.substring(0,y+1);break}}}catch(r){}var a={},w=function(e){var f=e.data,o=f.id;"error"==f.status&&console.log("Error: "+f.description),o in a&&("buffer"in f?a[o](f.buffer):(delete f.status,delete f.id,a[o](f)),delete a[o])};o.prototype.empty=function(e,f){if(e=t.checkShape(e),"undefined"==typeof f)f=new d("f64");else if(!(f instanceof d))throw new TypeError(f+" is not an instance of DataType");var o=new n(e,f,this);return o._id=i.newArrayId(),this._pnaclObject.postMessage({id:i.newMessageId(),command:"empty",shape:new Uint32Array(e).buffer,datatype:f.type,out:o._id}),o},o.prototype.zeros=function(e,f){if(e=t.checkShape(e),"undefined"==typeof f)f=new d("f64");else if(!(f instanceof d))throw new TypeError(f+" is not an instance of DataType");var o=new n(e,f,this);return o._id=i.newArrayId(),this._pnaclObject.postMessage({id:i.newMessageId(),command:"zeros",shape:new Uint32Array(e).buffer,datatype:f.type,out:o._id}),o},o.prototype.ones=function(e,f){if(e=t.checkShape(e),"undefined"==typeof f)f=new d("f64");else if(!(f instanceof d))throw new TypeError(f+" is not an instance of DataType");var o=new n(e,f,this);return o._id=i.newArrayId(),this._pnaclObject.postMessage({id:i.newMessageId(),command:"ones",shape:new Uint32Array(e).buffer,datatype:f.type,out:o._id}),o},o.prototype.array=function(e,f){var o=[];if(t.discoverArrayShapeRecursive(e,o,0),"undefined"==typeof f)f=new d("f64");else if(!(f instanceof d))throw new TypeError(f+" is not an instance of DataType");var u=new n(o,f,this);u._id=i.newArrayId();var l=new f.arrayType(u.length);return t.copyArrayDataRecursive(l,e,o,0,0),this._pnaclObject.postMessage({id:i.newMessageId(),command:"array",shape:new Uint32Array(o).buffer,datatype:f.type,buffer:l.buffer,out:u._id}),u},o.prototype.linspace=function(e,f,o,u){if(!t.isReal(e))throw new TypeError(e+" is not a real number");if(!t.isReal(f))throw new TypeError(f+" is not a real number");if("undefined"==typeof o)o=50;else{if(!t.isInt(o))throw new TypeError(o+" is not an integer");if(0>=o)throw new RangeError("The number of samples must be positive")}if("undefined"==typeof u&&(u=!0),u&&1===o)throw new RangeError("The number of samples must be a least 2 (for start and end points)");var l=new d("f64"),p=new n([o],l,this);return p._id=i.newArrayId(),this._pnaclObject.postMessage({id:i.newMessageId(),command:"linspace",start:+e,stop:+f,samples:0|o,closed:!!u,datatype:l.type,out:p._id}),p},o.prototype.reshape=function(e,f){if(t.checkNDArray(e,"a"),f=t.checkShape(f),t.computeLength(f)!==e.length)throw new RangeError("The shape is not compatible with the array");var o=!e._decRef(),d=new n(f,e.dataType,this);return o?(d._id=e._id,o=!1):d._id=i.newArrayId(),this._pnaclObject.postMessage({id:i.newMessageId(),command:"reshape",a:o?-e._id:e._id,out:d._id,shape:new Uint32Array(f).buffer}),d},o.prototype.repeat=function(e,f,o,d){t.checkNDArray(e,"a"),f=t.checkRepeats(f),o=t.checkAxis(o,e.shape.length);var u=e.shape,l=u.slice(0);l[o]*=f,"undefined"==typeof d?(d=new n(l,e.dataType,this),d._id=i.newArrayId()):(t.checkNDArray(d,"out"),t.checkShapesCompatibility(d.shape,l),t.checkDataTypesCompatibility(e.dataType,d.dataType),d._incRef());var p=!e._decRef();return this._pnaclObject.postMessage({id:i.newMessageId(),command:"repeat",a:p?-e._id:e._id,out:d._id,repeats:f,axis:o}),d},o.prototype._invalidate=function(e){0!==e._id&&this._pnaclObject.postMessage({id:i.newMessageId(),command:"free","in":e._id})},o.prototype.get=function(){if(0===arguments.length)throw new Error("Callback argument missing");var e=arguments[arguments.length-1];if(1===arguments.length)throw new Error("At least one NDArray argument expected");for(var f=0;f<arguments.length-1;++f)t.checkNDArray(arguments[f],"argument "+f);for(var o=new Array(arguments.length-1),f=0;f<arguments.length-1;++f)o[f]=!arguments[f]._decRef();for(var n=arguments.length-1,d=new Array(n),f=0;n>f;f++){var u=arguments[f],l=i.newMessageId();a[l]=0===u.shape.length?function(f,o){return function(i){var t=new o(i);d[f]=t[0],0===--n&&e.apply(null,d)}}(f,u.dataType.arrayType):function(f,o,i){return function(u){var l=new Array(i[0]);t.createArrayRecursive(new o(u),l,i,0,0),d[f]=l,0===--n&&e.apply(null,d)}}(f,u.dataType.arrayType,u.shape),this._pnaclObject.postMessage({id:l,command:"get","in":o[f]?-u._id:u._id})}},o.prototype.info=function(e){var f=i.newMessageId();a[f]=e,this._pnaclObject.postMessage({id:f,command:"info"})};var b=function(e,f,o,d,u){var l=null,p=null,s=!1,y=!1;if(e instanceof n){if(l=e.shape,p=e.dataType,f instanceof n)t.checkShapesCompatibility(e.shape,f.shape),t.checkDataTypesCompatibility(e.dataType,f.dataType);else if(!t.isNumber(f))throw new TypeError("Unsupported type of b")}else{if(!t.isNumber(e))throw new TypeError("Unsupported type of a");l=f.shape,p=f.dataType,t.checkNDArray(f,"b")}e instanceof n&&(s=!e._decRef()),f instanceof n&&(y=!f._decRef());try{"undefined"==typeof o?(o=new n(l,p,d),s?(o._id=e._id,s=!1):y?(o._id=f._id,y=!1):o._id=i.newArrayId()):(t.checkNDArray(o,"out"),t.checkShapesCompatibility(l,o.shape),t.checkDataTypesCompatibility(p,o.dataType),o._incRef()),d._pnaclObject.postMessage(e instanceof n?f instanceof n?{id:i.newMessageId(),command:u,a:s?-e._id:e._id,b:y?-f._id:f._id,out:o._id}:{id:i.newMessageId(),command:u+"c",a:s?-e._id:e._id,b:f,out:o._id}:"add"==u||"mul"==u?{id:i.newMessageId(),command:u+"c",a:y?-f._id:f._id,b:e,out:o._id}:{id:i.newMessageId(),command:"r"+u+"c",a:f,b:s?-e._id:e._id,out:o._id})}catch(c){throw e instanceof n&&e._incRef(),f instanceof n&&f._incRef(),c}return o},m=function(e,f,o,d){t.checkNDArray(e,"a");var u=!e._decRef();try{"undefined"==typeof f?(f=new n(e.shape,e.dataType,o),u?(f._id=e._id,u=!1):f._id=i.newArrayId()):(t.checkNDArray(f,"out"),t.checkShapesCompatibility(e.shape,f.shape),t.checkDataTypesCompatibility(e.dataType,f.dataType),f._incRef())}catch(l){throw e._incRef(),l}return o._pnaclObject.postMessage({id:i.newMessageId(),command:d,a:u?-e._id:e._id,out:f._id}),f},g=function(e,f,o,d){t.checkNDArray(e,"a");var u=!e._decRef();try{"undefined"==typeof f?(f=new n([],e.dataType,o),f._id=i.newArrayId()):(t.checkNDArray(f,"out"),t.checkShapesCompatibility(f.shape,[]),t.checkDataTypesCompatibility(e.dataType,f.dataType),f._incRef())}catch(l){throw e._incRef(),l}return o._pnaclObject.postMessage({id:i.newMessageId(),command:d,a:u?-e._id:e._id,out:f._id}),f},x=function(e,f,o,d,u){t.checkNDArray(e,"a");var l=!e._decRef();try{t.checkAxis(f),"undefined"==typeof o?(o=new n(t.computeAxisReductionOutShape(e.shape,f),e.dataType,d),o._id=i.newArrayId()):(t.checkNDArray(o,"out"),t.checkShapesCompatibility(o.shape,[]),t.checkDataTypesCompatibility(e.dataType,o.dataType),o._incRef())}catch(p){throw e._incRef(),p}return d._pnaclObject.postMessage({id:i.newMessageId(),command:u,a:l?-e._id:e._id,axis:0|f,out:o._id}),o},j=function(e,f,o,d){t.checkNDArray(e,"a"),t.checkNDArray(f,"b"),t.checkDataTypesCompatibility(e.dataType,f.dataType);var u=!e._decRef(),l=!f._decRef();try{if("undefined"==typeof o){var p=e.shape,s=f.shape,y=Math.max(p.length-1,0),c=Math.max(s.length-2,0);if(p[y]!=s[c])throw new TypeError("Mismatch in reduction dimensions");for(var r=[],a=0;y>a;a++)r.push(p[a]);if(s.length>1){for(var a=0;c>a;a++)r.push(s[a]);r.push(s[s.length-1])}o=new n(r,e.dataType,d),o._id=i.newArrayId()}else if(o instanceof n)throw t.checkNDArray(o,"out"),t.checkDataTypesCompatibility(e.dataType,o.dataType),new Error("Not implemented")}catch(w){throw e._incRef(),f._incRef(),w}return d._pnaclObject.postMessage({id:i.newMessageId(),command:"dot",a:u?-e._id:e._id,b:l?-f._id:f._id,out:o._id}),o};o.prototype.add=function(e,f,o){return b(e,f,o,this,"add")},o.prototype.sub=function(e,f,o){return b(e,f,o,this,"sub")},o.prototype.mul=function(e,f,o){return b(e,f,o,this,"mul")},o.prototype.div=function(e,f,o){return b(e,f,o,this,"div")},o.prototype.neg=function(e,f){return m(e,f,this,"neg")},o.prototype.abs=function(e,f){return m(e,f,this,"abs")},o.prototype.exp=function(e,f){return m(e,f,this,"exp")},o.prototype.log=function(e,f){return m(e,f,this,"log")},o.prototype.sqrt=function(e,f){return m(e,f,this,"sqrt")},o.prototype.square=function(e,f){return m(e,f,this,"square")},o.prototype.min=function(e,f){if("undefined"==typeof f)return g(e,void 0,this,"min");if(t.isInt(f))return x(e,f,void 0,this,"amin");throw new TypeError("Unsupported axis type")},o.prototype.max=function(e,f){if("undefined"==typeof f)return g(e,void 0,this,"max");if(t.isInt(f))return x(e,f,void 0,this,"amax");throw new TypeError("Unsupported axis type")},o.prototype.sum=function(e,f){if("undefined"==typeof f)return g(e,void 0,this,"sum");if(t.isInt(f))return x(e,f,void 0,this,"asum");throw new TypeError("Unsupported axis type")},o.prototype.dot=function(e,f,o){return j(e,f,o,this)},f.exports=o},{"./DataType":1,"./NDArray":3,"./allocator":5,"./util":8}],5:[function(e,f,o){"use strict";var n=1,d=1;o.newMessageId=function(){var e=n;return n=n+1|0,e},o.newArrayId=function(){var e=d;return d=d+1|0,e}},{}],6:[function(e,f,o){"use strict";var n=e("./DataType"),d=e("./JSContext"),i=e("./PNaClContext"),t=e("./webcl/WebCLContext"),u=function(e,f){if("undefined"==typeof f&&(f=e,e=void 0),"undefined"==typeof e&&(e=l()),"javascript"===e)return new d(f);if("pnacl"===e)return new i(f);if("webcl"===e)return new t(f);throw new Error("Unsupported backend: "+e)},l=function(){return s("webcl")?"webcl":s("pnacl")?"pnacl":"javascript"},p=function(){var e=[];return s("webcl")&&e.push("webcl"),s("pnacl")&&e.push("pnacl"),s("asm.js")&&e.push("asm.js"),e.push("javascript"),e},s=function(f){switch(f){case"asm.js":try{for(var o=window.navigator.userAgent,n=o.split(/\s+/),d=/[Ff]irefox\/(\d+)/g,i=0;i<n.length;++i){var t=n[i],u=d.exec(t);if(null!==u){var l=parseInt(u[1]);return l>=29}}return!1}catch(p){}return!1;case"simd.js":return"undefined"!=typeof SIMD&&"undefined"!=typeof Float32x4Array&&"undefined"!=typeof Int32x4Array;case"webgl":try{var s=document.createElement("canvas");try{if(null!==s.getContext("webgl"))return!0}catch(p){}try{if(null!==s.getContext("experimental-webgl"))return!0}catch(p){}}catch(p){}return!1;case"webcl":if("undefined"!=typeof webcl)try{var y=webcl.getPlatforms();return y.length>=1}catch(p){return!1}else try{var c=e("node-webcl"),y=c.getPlatforms();return y.length>=1}catch(p){return!1}return!1;case"pnacl":try{return"undefined"!=typeof navigator.mimeTypes["application/x-pnacl"]}catch(p){}return!1;case"nacl":try{return"undefined"!=typeof navigator.mimeTypes["application/x-nacl"]}catch(p){}return!1;default:throw new Error("Unknown feature: "+f)}};o.init=u,o.hasFeature=s,o.getDefaultBackend=l,o.getSupportedBackends=p,o.DataType=n},{"./DataType":1,"./JSContext":2,"./PNaClContext":4,"./webcl/WebCLContext":9}],7:[function(e,f,o){"use strict";o.fill=function(e,f){for(var o=e.length,n=0;o>n;++n)e[n]=f},o.add=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]+f[d]},o.addConst=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]+f},o.sub=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]-f[d]},o.subConst=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]-f},o.subRevConst=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=f-e[d]},o.mul=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]*f[d]},o.mulConst=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]*f},o.div=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]/f[d]},o.divConst=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=e[d]/f},o.divRevConst=function(e,f,o){for(var n=o.length,d=0;n>d;++d)o[d]=f/e[d]},o.neg=function(e,f){for(var o=f.length,n=0;o>n;++n)f[n]=-e[n]},o.abs=function(e,f){for(var o=f.length,n=0;o>n;++n)f[n]=Math.abs(e[n])},o.exp=function(e,f){for(var o=f.length,n=0;o>n;++n)f[n]=Math.exp(e[n])},o.log=function(e,f){for(var o=f.length,n=0;o>n;++n)f[n]=Math.log(e[n])},o.sqrt=function(e,f){for(var o=f.length,n=0;o>n;++n)f[n]=Math.sqrt(e[n])},o.square=function(e,f){for(var o=f.length,n=0;o>n;++n){var d=e[n];f[n]=d*d}},o.min=function(e,f){for(var o=e.length,n=e[0],d=1;o>d;++d)n=Math.min(n,e[d]);f[0]=n},o.max=function(e,f){for(var o=e.length,n=e[0],d=1;o>d;++d)n=Math.max(n,e[d]);f[0]=n},o.sum=function(e,f){for(var o=e.length,n=0,d=0;o>d;++d)n+=e[d];f[0]=n},o.axisMin=function(e,f,o,n,d){for(var i=0;o>i;++i)for(var t=0;n>t;++t){for(var u=i*d*n+t,l=e[u],p=1;d>p;++p)u+=n,l=Math.min(l,e[u]);f[i*n+t]=l}},o.axisMax=function(e,f,o,n,d){for(var i=0;o>i;++i)for(var t=0;n>t;++t){for(var u=i*d*n+t,l=e[u],p=1;d>p;++p)u+=n,l=Math.max(l,e[u]);f[i*n+t]=l}},o.axisSum=function(e,f,o,n,d){for(var i=0;o>i;++i)for(var t=0;n>t;++t){for(var u=i*d*n+t,l=e[u],p=1;d>p;++p)u+=n,l+=e[u];f[i*n+t]=l}},o.dot=function(e,f,o,n,d,i,t){for(var u=0;n>u;++u)for(var l=0;t>l;++l)for(var p=0;d>p;++p)for(var s=0;i>s;++s)o[(u*d+p)*i+s]+=e[u*t+l]*f[(p*t+l)*i+s]},o.repeat=function(e,f,o,n,d,i){if(i>n)for(var t=0;o>t;++t)for(var u=0;d>u;++u)for(var l=0;n>l;++l)for(var p=e[(t*d+u)*n+l],s=0;i>s;++s)f[((t*d+u)*i+s)*n+l]=p;else for(var t=0;o>t;++t)for(var u=0;d>u;++u)for(var y=e.subarray((t*d+u)*n,(t*d+u+1)*n),s=0;i>s;++s)f.set(y,((t*d+u)*i+s)*n)}},{}],8:[function(e,f,o){"use strict";var n=function(e){return e===+e};o.isNumber=n;var d=function(e){return e===+e&&isFinite(e)};o.isReal=d;var i=function(e){return e===(0|e)};o.isInt=i,o.isPositiveInt=function(e){return e===+e&&e===(0|e)&&e>0},o.isNonNegativeInt=function(e){return e===+e&&e===(0|e)&&e>=0};var t=function(e){return e instanceof Array};o.isArray=t,o.isIntArray=function(e){if(o.isArray(e)){for(var f=0;f<e.length;f++)if(!o.isInt(e[f]))return!1;return!0}return!1},o.isPositiveIntArray=function(e){if(o.isArray(e)){for(var f=0;f<e.length;f++)if(!o.isPositiveInt(e[f]))return!1;return!0}return!1},o.asIntArray=function(e){if(o.isInt(e))return[e];if(o.isIntArray(e))return e;throw new TypeError(e+" can not be converted to integer array")};var u=function(e){if(n(e))return u([e]);if(t(e)){for(var f=e.length,o=new Array(f),d=0;f>d;d++){if(!n(e[d]))throw new Error("Shape has non-numeric dimensions");if(!i(e[d]))throw new Error("Shape must have integer dimensions");if(e[d]<1)throw new Error("Degenerate shape");o[d]=0|e[d]}return o}};o.checkShape=u,o.checkShapesCompatibility=function(e,f){if(e.length!=f.length)throw new Error("The shapes have different dimensions");for(var o=e.length,n=0;o>n;n++)if(e[n]!=f[n])throw new Error("The shapes are different")},o.computeLength=function(e){for(var f=1,o=0;o<e.length;++o)f*=e[o];return f},o.checkDataType=function(f){var o=e("./DataType");if(!(f instanceof o))throw new TypeError("dataType is not an instance of DataType");return f},o.checkDataTypesCompatibility=function(e,f){if(!e.equals(f))throw new Error("The data types are not compatible")},o.checkNDArray=function(f,o){var n=e("./NDArray");if(!(f instanceof n))throw new TypeError(o+" is not an NDArray");if(!f.isValid())throw new Error(o+" is an invalidated array")},o.checkDifferentNDArrays=function(e,f,o,n){if(e===f)throw new Error("The arrays "+o+" and "+n+" must be different")},o.checkRepeats=function(e){if(!i(e))throw new TypeError("Repeats is not an integer");if(1>=e)throw new RangeError("Repeats should be greater than 1");return 0|e},o.checkAxis=function(e,f){if(!i(e))throw new TypeError("Axis is not an integer");if(0>e)throw new RangeError("Axis is negative");if(e>=f)throw new RangeError("Axis out of range");return 0|e},o.checkAxisReductionOutShape=function(e,f,o){if(e.length!==f.length+1)throw new Error("Output array has invalid number of dimensions for this operation");for(var n=0;o>n;++n)if(e[n]!==f[n])throw new Error("Output array has invalid shape for this operation");for(var n=o+1;n<e.length;++n)if(e[n]!==f[n-1])throw new Error("Output array has invalid shape for this operation")},o.computeAxisReductionOutShape=function(e,f){for(var o=[],n=0;n<e.length;++n)n!==f&&o.push(e[n]);return o},o.computeOuterStride=function(e,f){for(var o=1,n=0;f>n;++n)o*=e[n];return o},o.computeInnerStride=function(e,f){for(var o=1,n=f+1;n<e.length;++n)o*=e[n];return o};var l=function(e,f,o){if(t(e)){if(f.length<=o)f.push(e.length);else if(f[o]!=e.length)throw new RangeError("Sub-array "+e+" does not match the expected dimension of "+f[o]);for(var d=0;d<e.length;d++)l(e[d],f,o+1)}else{if(o!=f.length)throw new RangeError("Sub-array ["+e+"] does not match the expected dimension of "+f[o]);if(!n(e))throw new TypeError("Non-numeric element: "+e)}};o.discoverArrayShapeRecursive=l;var p=function(e,f,o,n,d){var i=o[n];if(n===o.length-1)e.set(f,d*i);else for(var t=0;i>t;t++)p(e,f[t],o,n+1,d*i+t)};o.copyArrayDataRecursive=p;var s=function(e,f,o,n,d){var i=o[n];if(n===o.length-1)for(var t=0;i>t;t++)f[t]=e[d*i+t];else for(var t=0;i>t;t++)f[t]=new Array(o[n+1]),s(e,f[t],o,n+1,d*i+t)};o.createArrayRecursive=s},{"./DataType":1,"./NDArray":3}],9:[function(e,f){"use strict";function o(f){if("undefined"==typeof l&&(l=e("node-webcl")),null===p){var o="kernel void set_f32(\n	uint length,\n	global float* out,\n	float value)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = value;\n	}\n}\nkernel void set_f64(\n	uint length,\n	global double* out,\n	double value)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = value;\n	}\n}\n\nkernel void linspace_f32(\n	uint length,\n	global float* out,\n	float start,\n	float step)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = start + step * ((float) id);\n	}\n}\nkernel void linspace_f64(\n	uint length,\n	global double* out,\n	double start,\n	double step)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = start + step * ((double) id);\n	}\n}\nkernel void repeat_f32(\n	uint expansionDim,\n	uint innerStride,\n	uint repeats,\n	global float *restrict a,\n	global float *restrict out)\n{\n	const uint i = get_global_id(0);\n	const uint j = get_global_id(1);\n	const uint k = get_global_id(2);\n	const float value = a[(i * expansionDim + j) * innerStride + k];\n	uint offsetOut = (i * expansionDim + j) * repeats * innerStride + k;\n	for (uint c = 0; c < repeats; ++c) {\n		out[offsetOut] = value;\n		offsetOut += innerStride;\n	}\n}\nkernel void repeat_f64(\n	uint expansionDim,\n	uint innerStride,\n	uint repeats,\n	global double *restrict a,\n	global double *restrict out)\n{\n	const uint i = get_global_id(0);\n	const uint j = get_global_id(1);\n	const uint k = get_global_id(2);\n	const double value = a[(i * expansionDim + j) * innerStride + k];\n	uint offsetOut = (i * expansionDim + j) * repeats * innerStride + k;\n	for (uint c = 0; c < repeats; ++c) {\n		out[offsetOut] = value;\n		offsetOut += innerStride;\n	}\n}\n\nkernel void add_f32(\n	uint length,\n	global float* a,\n	global float* b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] + b[id];\n	}\n}\nkernel void add_f64(\n	uint length,\n	global double* a,\n	global double* b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] + b[id];\n	}\n}\nkernel void sub_f32(\n	uint length,\n	global float* a,\n	global float* b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] - b[id];\n	}\n}\nkernel void sub_f64(\n	uint length,\n	global double* a,\n	global double* b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] - b[id];\n	}\n}\nkernel void mul_f32(\n	uint length,\n	global float* a,\n	global float* b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] * b[id];\n	}\n}\nkernel void mul_f64(\n	uint length,\n	global double* a,\n	global double* b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] * b[id];\n	}\n}\nkernel void div_f32(\n	uint length,\n	global float* a,\n	global float* b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] / b[id];\n	}\n}\nkernel void div_f64(\n	uint length,\n	global double* a,\n	global double* b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] / b[id];\n	}\n}\nkernel void addc_f32(\n	uint length,\n	global float* a,\n	float b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] + b;\n	}\n}\nkernel void addc_f64(\n	uint length,\n	global double* a,\n	double b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] + b;\n	}\n}\nkernel void subc_f32(\n	uint length,\n	global float* a,\n	float b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] - b;\n	}\n}\nkernel void subc_f64(\n	uint length,\n	global double* a,\n	double b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] - b;\n	}\n}\nkernel void subrc_f32(\n	uint length,\n	global float* a,\n	float b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = b / a[id];\n	}\n}\nkernel void subrc_f64(\n	uint length,\n	global double* a,\n	double b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = b / a[id];\n	}\n}\nkernel void mulc_f32(\n	uint length,\n	global float* a,\n	float b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] * b;\n	}\n}\nkernel void mulc_f64(\n	uint length,\n	global double* a,\n	double b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] * b;\n	}\n}\nkernel void divc_f32(\n	uint length,\n	global float* a,\n	float b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] / b;\n	}\n}\nkernel void divc_f64(\n	uint length,\n	global double* a,\n	double b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = a[id] / b;\n	}\n}\nkernel void divrc_f32(\n	uint length,\n	global float* a,\n	float b,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = b / a[id];\n	}\n}\nkernel void divrc_f64(\n	uint length,\n	global double* a,\n	double b,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = b / a[id];\n	}\n}\nkernel void neg_f32(\n	uint length,\n	global float* a,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = -a[id];\n	}\n}\nkernel void neg_f64(\n	uint length,\n	global double* a,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = -a[id];\n	}\n}\nkernel void abs_f32(\n	uint length,\n	global float* a,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = fabs(a[id]);\n	}\n}\nkernel void abs_f64(\n	uint length,\n	global double* a,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = fabs(a[id]);\n	}\n}\nkernel void exp_f32(\n	uint length,\n	global float* a,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = exp(a[id]);\n	}\n}\nkernel void exp_f64(\n	uint length,\n	global double* a,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = exp(a[id]);\n	}\n}\nkernel void log_f32(\n	uint length,\n	global float* a,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = log(a[id]);\n	}\n}\nkernel void log_f64(\n	uint length,\n	global double* a,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = log(a[id]);\n	}\n}\nkernel void sqrt_f32(\n	uint length,\n	global float* a,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = sqrt(a[id]);\n	}\n}\nkernel void sqrt_f64(\n	uint length,\n	global double* a,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		out[id] = sqrt(a[id]);\n	}\n}\nkernel void square_f32(\n	uint length,\n	global float* a,\n	global float* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		const float aVal = a[id]; \n		out[id] = aVal * aVal;\n	}\n}\nkernel void square_f64(\n	uint length,\n	global double* a,\n	global double* out)\n{\n	const uint id = get_global_id(0);\n	if (id < length) {\n		const double aVal = a[id];\n		out[id] = aVal * aVal;\n	}\n}\n\nkernel void min_f32(\n	uint length,\n	global float *restrict a,\n	global float *restrict out)\n{\n	\n}",n=l.getPlatforms(),d=n[0],i=d.getDevices(l.DEVICE_TYPE_ALL),t=i[0];
p=l.createContext(t),s=p.createCommandQueue();var u=p.createProgram(o);try{u.build([t])}catch(c){if("INVALID_DEVICE"!==c.name)throw c;u.build()}y.set.f32=u.createKernel("set_f32"),y.set.f64=u.createKernel("set_f64"),y.linspace.f32=u.createKernel("linspace_f32"),y.linspace.f64=u.createKernel("linspace_f64"),y.repeat.f32=u.createKernel("repeat_f32"),y.repeat.f64=u.createKernel("repeat_f64"),y.add.f32=u.createKernel("add_f32"),y.add.f64=u.createKernel("add_f64"),y.sub.f32=u.createKernel("sub_f32"),y.sub.f64=u.createKernel("sub_f64"),y.mul.f32=u.createKernel("mul_f32"),y.mul.f64=u.createKernel("mul_f64"),y.div.f32=u.createKernel("div_f32"),y.div.f64=u.createKernel("div_f64"),y.addc.f32=u.createKernel("addc_f32"),y.addc.f64=u.createKernel("addc_f64"),y.subc.f32=u.createKernel("subc_f32"),y.subc.f64=u.createKernel("subc_f64"),y.subrc.f32=u.createKernel("subrc_f32"),y.subrc.f64=u.createKernel("subrc_f64"),y.mulc.f32=u.createKernel("mulc_f32"),y.mulc.f64=u.createKernel("mulc_f64"),y.divc.f32=u.createKernel("divc_f32"),y.divc.f64=u.createKernel("divc_f64"),y.divrc.f32=u.createKernel("divrc_f32"),y.divrc.f64=u.createKernel("divrc_f64"),y.neg.f32=u.createKernel("neg_f32"),y.neg.f64=u.createKernel("neg_f64"),y.abs.f32=u.createKernel("abs_f32"),y.abs.f64=u.createKernel("abs_f64"),y.exp.f32=u.createKernel("exp_f32"),y.exp.f64=u.createKernel("exp_f64"),y.log.f32=u.createKernel("log_f32"),y.log.f64=u.createKernel("log_f64"),y.sqrt.f32=u.createKernel("sqrt_f32"),y.sqrt.f64=u.createKernel("sqrt_f64"),y.square.f32=u.createKernel("square_f32"),y.square.f64=u.createKernel("square_f64")}f(this)}var n=e("../NDArray"),d=e("../DataType"),i=e("../util"),t=!1,u=!1,l="object"==typeof window?window.webcl:void 0,p=null,s=null,y={set:{},linspace:{},repeat:{},add:{},sub:{},mul:{},div:{},addc:{},subc:{},subrc:{},mulc:{},divc:{},divrc:{},neg:{},abs:{},exp:{},log:{},sqrt:{},square:{}};o.prototype.empty=function(e,f){if(e=i.checkShape(e),"undefined"==typeof f)f=new d("f64");else if(!(f instanceof d))throw new TypeError(f+" is not an instance of DataType");var o=new n(e,f,this);return o._buffer=p.createBuffer(l.MEM_READ_WRITE,o.length*f.size),o},o.prototype.zeros=function(e,f){if(e=i.checkShape(e),"undefined"==typeof f)f=new d("f64");else if(!(f instanceof d))throw new TypeError(f+" is not an instance of DataType");var o=new n(e,f,this);o._buffer=p.createBuffer(l.MEM_READ_WRITE,o.length*f.size);var t=y.set[f.type];return t.setArg(0,new Uint32Array([o.length])),t.setArg(1,o._buffer),t.setArg(2,new f.arrayType([0])),s.enqueueNDRangeKernel(t,1,null,[o.length],null),o},o.prototype.ones=function(e,f){if(e=i.checkShape(e),"undefined"==typeof f)f=new d("f64");else if(!(f instanceof d))throw new TypeError(f+" is not an instance of DataType");var o=new n(e,f,this);o._buffer=p.createBuffer(l.MEM_READ_WRITE,o.length*f.size);var t=y.set[f.type];return t.setArg(0,new Uint32Array([o.length])),t.setArg(1,o._buffer),t.setArg(2,new f.arrayType([1])),s.enqueueNDRangeKernel(t,1,null,[o.length],null),o},o.prototype.array=function(e,f){f="undefined"==typeof f?new d("f64"):i.checkDataType(f);var o=[];i.discoverArrayShapeRecursive(e,o,0);var t=new n(o,f,this),y=new f.arrayType(t.length);return i.copyArrayDataRecursive(y,e,o,0,0),u?t._buffer=p.createBuffer(l.MEM_READ_WRITE,y.byteLength,y):(t._buffer=p.createBuffer(l.MEM_READ_WRITE,y.byteLength),s.enqueueWriteBuffer(t._buffer,!1,0,y.byteLength,y)),t},o.prototype.linspace=function(e,f,o,t){if(!i.isReal(e))throw new TypeError(e+" is not a real number");if(!i.isReal(f))throw new TypeError(f+" is not a real number");if("undefined"==typeof o)o=50;else{if(!i.isInt(o))throw new TypeError(o+" is not an integer");if(0>=o)throw new RangeError("The number of samples must be positive")}if("undefined"==typeof t&&(t=!0),t&&1===o)throw new RangeError("The number of samples must be a least 2 (for start and end points)");var u=new d("f64"),c=new n(o,u,this);c._buffer=p.createBuffer(l.MEM_READ_WRITE,o*u.size);var r=f-e,a=t?o-1:o,w=r/a,b=y.linspace[u.type];return b.setArg(0,new Uint32Array([c.length])),b.setArg(1,c._buffer),b.setArg(2,new u.arrayType([e])),b.setArg(3,new u.arrayType([w])),s.enqueueNDRangeKernel(b,1,null,[c.length],null),c},o.prototype._invalidate=function(e){null!==e._buffer&&("undefined"!=typeof e._buffer.release&&e._buffer.release(),e._buffer=null)},o.prototype.get=function(){if(0===arguments.length)throw new Error("Callback argument missing");var e=arguments[arguments.length-1];if(1===arguments.length)throw new Error("At least one NDArray argument expected");for(var f=0;f<arguments.length-1;f++)if(!(arguments[f]instanceof n))throw new TypeError("Argument "+f+" is not an NDArray");var o=arguments.length-1,d=new Array(o);if(t)for(var f=0;o>f;f++){var u=arguments[f];!function(f,n,t){var p=new t(length),y=new WebCLEvent;s.enqueueReadBuffer(u._buffer,!1,0,p.byteLength,p,null,y),0===n.length?y.setCallback(l.COMPLETE,function(){y.release(),d[f]=p[0],0===--o&&e.apply(null,d)}):y.setCallback(l.COMPLETE,function(){y.release();var u=new Array(n[0]);i.createArrayRecursive(new t(p),u,n,0,0),d[f]=u,0===--o&&e.apply(null,d)})}(f,u.shape,u.dataType.arrayType)}else{for(var f=0;o>f;f++){var u=arguments[f],p=new u.dataType.arrayType(u.length);if(s.enqueueReadBuffer(u._buffer,!0,0,p.byteLength,p),0===u.shape.length)d[f]=p[0];else{var y=new Array(u.shape[0]);i.createArrayRecursive(new u.dataType.arrayType(p),y,u.shape,0,0),d[f]=y}}e.apply(null,d)}},o.prototype.reshape=function(e,f){if(f=i.checkShape(f),i.computeLength(f)!==e.length)throw new RangeError("The shape is not compatible with the array");var o=new n(f,e.dataType,this);return e._decRef()?(o._buffer=p.createBuffer(webcl.MEM_READ_WRITE,o.length*o.dataType.size),s.enqueueCopyBuffer(e._buffer,o._buffer,0,0,o.length*o.dataType.size)):(o._buffer=e._buffer,e._buffer=null),o},o.prototype.repeat=function(e,f,o,d){i.checkNDArray(e,"a"),f=i.checkRepeats(f),o=i.checkAxis(o,e.shape.length);var t=e.shape,u=t.slice(0);u[o]*=f,e._decRef();try{"undefined"==typeof d?(d=new n(u,e.dataType,this),d._buffer=p.createBuffer(webcl.MEM_READ_WRITE,d.length*d.dataType.size)):(i.checkNDArray(d,"out"),i.checkShapesCompatibility(d.shape,u),i.checkDataTypesCompatibility(e.dataType,d.dataType),d._incRef());var l=i.computeOuterStride(t,o),c=t[o],r=i.computeInnerStride(t,o),a=y.repeat[e.dataType.type];a.setArg(0,new Uint32Array([c])),a.setArg(1,new Uint32Array([r])),a.setArg(2,new Uint32Array([f])),a.setArg(3,e._buffer),a.setArg(4,d._buffer),s.enqueueNDRangeKernel(a,3,null,[l,c,r],null)}catch(w){throw e._incRef(),w}return e._tryInvalidate(),d};var c=function(e,f,o,d,t,u,y){var c=null,r=null,a=null,w=null;if(e instanceof n){if(a=e._buffer,c=e.shape,r=e.dataType,f instanceof n)w=f._buffer,i.checkShapesCompatibility(e.shape,f.shape),i.checkDataTypesCompatibility(e.dataType,f.dataType);else if(!i.isNumber(f))throw new TypeError("Unsupported type of b")}else{if(!i.isNumber(e))throw new TypeError("Unsupported type of a");i.checkNDArray(f,"b"),w=f._buffer,c=f.shape,r=f.dataType}e instanceof n&&e._decRef(),f instanceof n&&f._decRef();try{if("undefined"==typeof o?(o=new n(c,r,d),e instanceof n&&!e._hasRefs()?(o._buffer=e._buffer,e._buffer=null):f instanceof n&&!f._hasRefs()?(o._buffer=f._buffer,f._buffer=null):o._buffer=p.createBuffer(l.MEM_READ_WRITE,o.length*o.dataType.size)):(i.checkNDArray(o,"out"),i.checkShapesCompatibility(c,o.shape),i.checkDataTypesCompatibility(r,o.dataType),o._incRef()),e instanceof n)if(f instanceof n){var b=t[r.type];b.setArg(0,new Uint32Array([o.length])),b.setArg(1,a),b.setArg(2,w),b.setArg(3,o._buffer),s.enqueueNDRangeKernel(b,1,null,[o.length],null)}else{var b=u[r.type];b.setArg(0,new Uint32Array([o.length])),b.setArg(1,a),b.setArg(2,new r.arrayType([f])),b.setArg(3,o._buffer),s.enqueueNDRangeKernel(b,1,null,[o.length],null)}else{var b=y[r.type];b.setArg(0,new Uint32Array([o.length])),b.setArg(1,w),b.setArg(2,new r.arrayType([e])),b.setArg(3,o._buffer),s.enqueueNDRangeKernel(b,1,null,[o.length],null)}}catch(m){throw e instanceof n&&e._incRef(),f instanceof n&&f._incRef(),m}return e instanceof n&&e._tryInvalidate(),f instanceof n&&f._tryInvalidate(),o},r=function(e,f,o,d){i.checkNDArray(e,"a"),e._decRef();var t=e._buffer;try{"undefined"==typeof f?(f=new n(e.shape,e.dataType,o),e instanceof n&&!e._hasRefs()?(f._buffer=e._buffer,e._buffer=null):f._buffer=p.createBuffer(l.MEM_READ_WRITE,f.length*f.dataType.size)):(i.checkNDArray(f,"out"),i.checkShapesCompatibility(e.shape,f.shape),i.checkDataTypesCompatibility(e.dataType,f.dataType),f._incRef());var u=d[e.dataType.type];u.setArg(0,new Uint32Array([f.length])),u.setArg(1,t),u.setArg(2,f._buffer),s.enqueueNDRangeKernel(u,1,null,[f.length],null)}catch(y){throw e._incRef(),y}return e._tryInvalidate(),f};o.prototype.add=function(e,f,o){return c(e,f,o,this,y.add,y.addc,y.addc)},o.prototype.sub=function(e,f,o){return c(e,f,o,this,y.sub,y.subc,y.subrc)},o.prototype.mul=function(e,f,o){return c(e,f,o,this,y.mul,y.mulc,y.mulc)},o.prototype.div=function(e,f,o){return c(e,f,o,this,y.div,y.divc,y.divrc)},o.prototype.neg=function(e,f){return r(e,f,this,y.neg)},o.prototype.abs=function(e,f){return r(e,f,this,y.abs)},o.prototype.exp=function(e,f){return r(e,f,this,y.exp)},o.prototype.log=function(e,f){return r(e,f,this,y.log)},o.prototype.sqrt=function(e,f){return r(e,f,this,y.sqrt)},o.prototype.square=function(e,f){return r(e,f,this,y.square)},f.exports=o},{"../DataType":1,"../NDArray":3,"../util":8}]},{},[6])(6)});